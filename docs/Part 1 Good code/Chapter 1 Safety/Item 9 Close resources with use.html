
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Item 9 Close Resources With Use · GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="Item 10 Write unit tests.html" />
    
    
    <link rel="prev" href="Item 8 Handle nulls properly.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
                <span>
            
                    
                    Part 1 Good Code
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" >
            
                <span>
            
                    
                    Chapter 1 Safety
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1.1" data-path="Introduction.html">
            
                <a href="Introduction.html">
            
                    
                    引言
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.2" data-path="Item 1 Limit mutability.html">
            
                <a href="Item 1 Limit mutability.html">
            
                    
                    Item 1 Limit Mutability
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.3" data-path="Item 2 Minimize the scope of variables.html">
            
                <a href="Item 2 Minimize the scope of variables.html">
            
                    
                    第2条：最小化变量作用域
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.4" data-path="Item 3 Eliminate platform types as soon as possible.html">
            
                <a href="Item 3 Eliminate platform types as soon as possible.html">
            
                    
                    Item 3 Eliminate Platform Types As Soon As Possible
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.5" data-path="Item 4 Do not expose inferred types.html">
            
                <a href="Item 4 Do not expose inferred types.html">
            
                    
                    第4条：不要把推断类型暴露给外部
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.6" data-path="Item 5 Specify your expectations on arguments and state.html">
            
                <a href="Item 5 Specify your expectations on arguments and state.html">
            
                    
                    Item 5 Specify Your Expectations On Arguments And State
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.7" data-path="Item 6 Prefer standard errors to custom ones.html">
            
                <a href="Item 6 Prefer standard errors to custom ones.html">
            
                    
                    第6条：尽可能使用标准库中提供的异常
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.8" data-path="Item 7 Prefer null or Failure result when the lack of result is possible.html">
            
                <a href="Item 7 Prefer null or Failure result when the lack of result is possible.html">
            
                    
                    Item 7 Prefer Null Or Failure Result When The Lack Of Result Is Possible
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.9" data-path="Item 8 Handle nulls properly.html">
            
                <a href="Item 8 Handle nulls properly.html">
            
                    
                    Item 8 Handle Nulls Properly
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.2.1.10" data-path="Item 9 Close resources with use.html">
            
                <a href="Item 9 Close resources with use.html">
            
                    
                    Item 9 Close Resources With Use
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.11" data-path="Item 10 Write unit tests.html">
            
                <a href="Item 10 Write unit tests.html">
            
                    
                    Item 10 Write Unit Tests
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.2" >
            
                <span>
            
                    
                    Chapter 2 Readability
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.2.1" data-path="../Chapter 2 Readability/Introduction.html">
            
                <a href="../Chapter 2 Readability/Introduction.html">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.2" data-path="../Chapter 2 Readability/Item 11 Design for readability.html">
            
                <a href="../Chapter 2 Readability/Item 11 Design for readability.html">
            
                    
                    Item 11 Design For Readability
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.3" data-path="../Chapter 2 Readability/Item 12 Operator meaning should be consistent with its function name.html">
            
                <a href="../Chapter 2 Readability/Item 12 Operator meaning should be consistent with its function name.html">
            
                    
                    Item 12 Operator Meaning Should Be Consistent With Its Function Name
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.4" data-path="../Chapter 2 Readability/Item 13 Avoid returning or operating on Unit?.md">
            
                <span>
            
                    
                    Item 13 Avoid Returning Or Operating On Unit
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.5" data-path="../Chapter 2 Readability/Item 14 Specify the variable type when it is not clear.html">
            
                <a href="../Chapter 2 Readability/Item 14 Specify the variable type when it is not clear.html">
            
                    
                    Item 14 Specify The Variable Type When It Is Not Clear
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.6" data-path="../Chapter 2 Readability/Item 15 Consider referencing receivers explicitly.html">
            
                <a href="../Chapter 2 Readability/Item 15 Consider referencing receivers explicitly.html">
            
                    
                    Item 15 Consider Referencing Receivers Explicitly
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.7" data-path="../Chapter 2 Readability/Item 16 Properties should represent state not behavior.html">
            
                <a href="../Chapter 2 Readability/Item 16 Properties should represent state not behavior.html">
            
                    
                    Item 16 Properties Should Represent State Not Behavior
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.8" data-path="../Chapter 2 Readability/Item 17 Consider naming arguments.html">
            
                <a href="../Chapter 2 Readability/Item 17 Consider naming arguments.html">
            
                    
                    Item 17 Consider Naming Arguments
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.9" data-path="../Chapter 2 Readability/Item 18 Respect coding conventions.html">
            
                <a href="../Chapter 2 Readability/Item 18 Respect coding conventions.html">
            
                    
                    Item 18 Respect Coding Conventions
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                    Part 2 Code Design
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" >
            
                <span>
            
                    
                    Chapter 3 Reusability
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1.1" data-path="../../Part 2 Code design/Chapter 3 Reusability/Introduction.html">
            
                <a href="../../Part 2 Code design/Chapter 3 Reusability/Introduction.html">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.2" data-path="../../Part 2 Code design/Chapter 3 Reusability/Item 19 Do not repeat knowledge.html">
            
                <a href="../../Part 2 Code design/Chapter 3 Reusability/Item 19 Do not repeat knowledge.html">
            
                    
                    Item 19 Do Not Repeat Knowledge
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.3" data-path="../../Part 2 Code design/Chapter 3 Reusability/Item 20 Do not repeat common algorithms.html">
            
                <a href="../../Part 2 Code design/Chapter 3 Reusability/Item 20 Do not repeat common algorithms.html">
            
                    
                    Item 20 Do Not Repeat Common Algorithms
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.4" data-path="../../Part 2 Code design/Chapter 3 Reusability/Item 21 Use property delegation to extract common property patterns.html">
            
                <a href="../../Part 2 Code design/Chapter 3 Reusability/Item 21 Use property delegation to extract common property patterns.html">
            
                    
                    Item 21 Use Property Delegation To Extract Common Property Patterns
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.5" data-path="../../Part 2 Code design/Chapter 3 Reusability/Item 22 Use generics when implementing common algorithms.html">
            
                <a href="../../Part 2 Code design/Chapter 3 Reusability/Item 22 Use generics when implementing common algorithms.html">
            
                    
                    Item 22 Use Generics When Implementing Common Algorithms
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.6" data-path="../../Part 2 Code design/Chapter 3 Reusability/Item 23 Avoid shadowing type parameters.html">
            
                <a href="../../Part 2 Code design/Chapter 3 Reusability/Item 23 Avoid shadowing type parameters.html">
            
                    
                    Item 23 Avoid Shadowing Type Parameters
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.7" data-path="../../Part 2 Code design/Chapter 3 Reusability/Item 24 Consider variance for generic types.html">
            
                <a href="../../Part 2 Code design/Chapter 3 Reusability/Item 24 Consider variance for generic types.html">
            
                    
                    Item 24 Consider Variance For Generic Types
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.8" data-path="../../Part 2 Code design/Chapter 3 Reusability/Item 25 Reuse between different platforms by extracting common modules.html">
            
                <a href="../../Part 2 Code design/Chapter 3 Reusability/Item 25 Reuse between different platforms by extracting common modules.html">
            
                    
                    Item 25 Reuse Between Different Platforms By Extracting Common Modules
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.2" >
            
                <span>
            
                    
                    Chapter 4 Abstraction Design
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.2.1" data-path="../../Part 2 Code design/Chapter 4 Abstraction design/Introduction.html">
            
                <a href="../../Part 2 Code design/Chapter 4 Abstraction design/Introduction.html">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.2" data-path="../../Part 2 Code design/Chapter 4 Abstraction design/Item 26 Each function should be written in terms of a single level of abstraction.html">
            
                <a href="../../Part 2 Code design/Chapter 4 Abstraction design/Item 26 Each function should be written in terms of a single level of abstraction.html">
            
                    
                    Item 26 Each Function Should Be Written In Terms Of A Single Level Of Abstraction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.3" data-path="../../Part 2 Code design/Chapter 4 Abstraction design/Item 27 Use abstraction to protect code against changes.html">
            
                <a href="../../Part 2 Code design/Chapter 4 Abstraction design/Item 27 Use abstraction to protect code against changes.html">
            
                    
                    Item 27 Use Abstraction To Protect Code Against Changes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.4" data-path="../../Part 2 Code design/Chapter 4 Abstraction design/Item 28 Specify API stability.html">
            
                <a href="../../Part 2 Code design/Chapter 4 Abstraction design/Item 28 Specify API stability.html">
            
                    
                    Item 28 Specify API Stability
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.5" data-path="../../Part 2 Code design/Chapter 4 Abstraction design/Item 29 Consider wrapping external API.html">
            
                <a href="../../Part 2 Code design/Chapter 4 Abstraction design/Item 29 Consider wrapping external API.html">
            
                    
                    Item 29 Consider Wrapping External API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.6" data-path="../../Part 2 Code design/Chapter 4 Abstraction design/Item 30 Minimize elements visibility.html">
            
                <a href="../../Part 2 Code design/Chapter 4 Abstraction design/Item 30 Minimize elements visibility.html">
            
                    
                    Item 30 Minimize Elements Visibility
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.7" data-path="../../Part 2 Code design/Chapter 4 Abstraction design/Item 31 Define contract with documentation.html">
            
                <a href="../../Part 2 Code design/Chapter 4 Abstraction design/Item 31 Define contract with documentation.html">
            
                    
                    Item 31 Define Contract With Documentation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.8" data-path="../../Part 2 Code design/Chapter 4 Abstraction design/Item 32 Respect abstraction contracts.html">
            
                <a href="../../Part 2 Code design/Chapter 4 Abstraction design/Item 32 Respect abstraction contracts.html">
            
                    
                    Item 32 Respect Abstraction Contracts
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.3" >
            
                <span>
            
                    
                    Chapter 5 Object Creation
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.3.1" data-path="../../Part 2 Code design/Chapter 5 Object creation/Introduction.html">
            
                <a href="../../Part 2 Code design/Chapter 5 Object creation/Introduction.html">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.2" data-path="../../Part 2 Code design/Chapter 5 Object creation/Item 33 Consider factory functions instead of constructors.html">
            
                <a href="../../Part 2 Code design/Chapter 5 Object creation/Item 33 Consider factory functions instead of constructors.html">
            
                    
                    Item 33 Consider Factory Functions Instead Of Constructors
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.3" data-path="../../Part 2 Code design/Chapter 5 Object creation/Item 34 Consider a primary constructor with named optional arguments.html">
            
                <a href="../../Part 2 Code design/Chapter 5 Object creation/Item 34 Consider a primary constructor with named optional arguments.html">
            
                    
                    Item 34 Consider A Primary Constructor With Named Optional Arguments
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.4" data-path="../../Part 2 Code design/Chapter 5 Object creation/Item 35 Consider defining a DSL for complex object creation.html">
            
                <a href="../../Part 2 Code design/Chapter 5 Object creation/Item 35 Consider defining a DSL for complex object creation.html">
            
                    
                    Item 35 Consider Defining A DSL For Complex Object Creation
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.4" >
            
                <span>
            
                    
                    Chapter 6 Class Design
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.4.1" data-path="../../Part 2 Code design/Chapter 6 Class design/Introduction.html">
            
                <a href="../../Part 2 Code design/Chapter 6 Class design/Introduction.html">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4.2" data-path="../../Part 2 Code design/Chapter 6 Class design/Item 36 Prefer composition over inheritance.html">
            
                <a href="../../Part 2 Code design/Chapter 6 Class design/Item 36 Prefer composition over inheritance.html">
            
                    
                    Item 36 Prefer Composition Over Inheritance
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4.3" data-path="../../Part 2 Code design/Chapter 6 Class design/Item 37 Use the data modifier to represent a bundle of data.html">
            
                <a href="../../Part 2 Code design/Chapter 6 Class design/Item 37 Use the data modifier to represent a bundle of data.html">
            
                    
                    Item 37 Use The Data Modifier To Represent A Bundle Of Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4.4" data-path="../../Part 2 Code design/Chapter 6 Class design/Item 38 Use function types instead of interfaces to pass operations and actions.html">
            
                <a href="../../Part 2 Code design/Chapter 6 Class design/Item 38 Use function types instead of interfaces to pass operations and actions.html">
            
                    
                    Item 38 Use Function Types Instead Of Interfaces To Pass Operations And Actions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4.5" data-path="../../Part 2 Code design/Chapter 6 Class design/Item 39 Prefer class hierarchies to tagged classes.html">
            
                <a href="../../Part 2 Code design/Chapter 6 Class design/Item 39 Prefer class hierarchies to tagged classes.html">
            
                    
                    Item 39 Prefer Class Hierarchies To Tagged Classes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4.6" data-path="../../Part 2 Code design/Chapter 6 Class design/Item 40 Respect the contract of  equals.html">
            
                <a href="../../Part 2 Code design/Chapter 6 Class design/Item 40 Respect the contract of  equals.html">
            
                    
                    Item 40 Respect The Contract Of Equals
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4.7" data-path="../../Part 2 Code design/Chapter 6 Class design/Item 41 Respect the contract of  hashCode.html">
            
                <a href="../../Part 2 Code design/Chapter 6 Class design/Item 41 Respect the contract of  hashCode.html">
            
                    
                    Item 41 Respect The Contract Of Hash Code
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4.8" data-path="../../Part 2 Code design/Chapter 6 Class design/Item 42 Respect the contract of compareTo.html">
            
                <a href="../../Part 2 Code design/Chapter 6 Class design/Item 42 Respect the contract of compareTo.html">
            
                    
                    Item 42 Respect The Contract Of Compare To
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4.9" data-path="../../Part 2 Code design/Chapter 6 Class design/Item 43 Consider extracting non-essential parts of your API into extensions.html">
            
                <a href="../../Part 2 Code design/Chapter 6 Class design/Item 43 Consider extracting non-essential parts of your API into extensions.html">
            
                    
                    Item 43 Consider Extracting Non Essential Parts Of Your API Into Extensions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4.10" data-path="../../Part 2 Code design/Chapter 6 Class design/Item 44 Avoid member extensions.html">
            
                <a href="../../Part 2 Code design/Chapter 6 Class design/Item 44 Avoid member extensions.html">
            
                    
                    Item 44 Avoid Member Extensions
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" >
            
                <span>
            
                    
                    Part 3 Efficiency
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" >
            
                <span>
            
                    
                    Chapter 7 Make It Cheap
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1.1" data-path="../../Part 3 Efficiency/Chapter 7 Make it cheap/Introduction.html">
            
                <a href="../../Part 3 Efficiency/Chapter 7 Make it cheap/Introduction.html">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.2" data-path="../../Part 3 Efficiency/Chapter 7 Make it cheap/Item 45 Avoid unnecessary object creation.html">
            
                <a href="../../Part 3 Efficiency/Chapter 7 Make it cheap/Item 45 Avoid unnecessary object creation.html">
            
                    
                    Item 45 Avoid Unnecessary Object Creation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.3" data-path="../../Part 3 Efficiency/Chapter 7 Make it cheap/Item 46 Use inline modifier for functions with parameters of functional types.html">
            
                <a href="../../Part 3 Efficiency/Chapter 7 Make it cheap/Item 46 Use inline modifier for functions with parameters of functional types.html">
            
                    
                    Item 46 Use Inline Modifier For Functions With Parameters Of Functional Types
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.4" data-path="../../Part 3 Efficiency/Chapter 7 Make it cheap/Item 47 Consider using inline classes.html">
            
                <a href="../../Part 3 Efficiency/Chapter 7 Make it cheap/Item 47 Consider using inline classes.html">
            
                    
                    Item 47 Consider Using Inline Classes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.5" data-path="../../Part 3 Efficiency/Chapter 7 Make it cheap/Item 48 Eliminate obsolete object references.html">
            
                <a href="../../Part 3 Efficiency/Chapter 7 Make it cheap/Item 48 Eliminate obsolete object references.html">
            
                    
                    Item 48 Eliminate Obsolete Object References
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.2" >
            
                <span>
            
                    
                    Chapter 8 Efficient Collection Processing
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.2.1" data-path="../../Part 3 Efficiency/Chapter 8 Efficient collection processing/Introduction.html">
            
                <a href="../../Part 3 Efficiency/Chapter 8 Efficient collection processing/Introduction.html">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.2" data-path="../../Part 3 Efficiency/Chapter 8 Efficient collection processing/Item 49 Prefer Sequence for big collections with more than one processing step.html">
            
                <a href="../../Part 3 Efficiency/Chapter 8 Efficient collection processing/Item 49 Prefer Sequence for big collections with more than one processing step.html">
            
                    
                    Item 49 Prefer Sequence For Big Collections With More Than One Processing Step
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.3" data-path="../../Part 3 Efficiency/Chapter 8 Efficient collection processing/Item 50 Limit the number of operations.html">
            
                <a href="../../Part 3 Efficiency/Chapter 8 Efficient collection processing/Item 50 Limit the number of operations.html">
            
                    
                    Item 50 Limit The Number Of Operations
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.4" data-path="../../Part 3 Efficiency/Chapter 8 Efficient collection processing/Item 51 Consider Arrays with primitives for performance-critical processing.html">
            
                <a href="../../Part 3 Efficiency/Chapter 8 Efficient collection processing/Item 51 Consider Arrays with primitives for performance-critical processing.html">
            
                    
                    Item 51 Consider Arrays With Primitives For Performance Critical Processing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.5" data-path="../../Part 3 Efficiency/Chapter 8 Efficient collection processing/Item 52 Consider using mutable collections.html">
            
                <a href="../../Part 3 Efficiency/Chapter 8 Efficient collection processing/Item 52 Consider using mutable collections.html">
            
                    
                    Item 52 Consider Using Mutable Collections
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >Item 9 Close Resources With Use</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h2 id="item-9-close-resources-with-use">Item 9: Close resources with <code>use</code></h2>
<p>There are resources that cannot be closed automatically, and we need to invoke the <code>close</code> method once we do not need them anymore. The Java standard library, that we use in Kotlin/JVM, contains a lot of these resources, such as:</p>
<p>&#x6709;&#x4E9B;&#x8D44;&#x6E90;&#x4E0D;&#x80FD;&#x81EA;&#x52A8;&#x5173;&#x95ED;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x4E0D;&#x518D;&#x9700;&#x8981;&#x5B83;&#x4EEC;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x8C03;&#x7528;&apos; close &apos;&#x65B9;&#x6CD5;&#x3002;&#x6211;&#x4EEC;&#x5728;Kotlin/JVM&#x4E2D;&#x4F7F;&#x7528;&#x7684;Java&#x6807;&#x51C6;&#x5E93;&#xFF0C;&#x5305;&#x542B;&#x4E86;&#x5F88;&#x591A;&#x8FD9;&#x6837;&#x7684;&#x8D44;&#x6E90;&#xFF0C;&#x4F8B;&#x5982;:</p>
<ul>
<li><code>InputStream</code> and <code>OutputStream</code>,</li>
<li><code>java.sql.Connection</code>,</li>
<li><code>java.io.Reader</code> (<code>FileReader</code>, <code>BufferedReader</code>, <code>CSSParser</code>),</li>
<li><code>java.new.Socket</code> and <code>java.util.Scanner</code>.</li>
</ul>
<p>All these resources implement the <code>Closeable</code> interface, which extends <code>AutoCloseable</code>. 
&#x6240;&#x6709;&#x8FD9;&#x4E9B;&#x8D44;&#x6E90;&#x90FD;&#x5B9E;&#x73B0;&#x4E86;&apos; Closeable &apos;&#x63A5;&#x53E3;&#xFF0C;&#x5B83;&#x6269;&#x5C55;&#x4E86;&apos; AutoCloseable &apos;&#x3002;</p>
<p>The problem is that in all these cases, we need to be sure that we invoke the <code>close</code> method when we no longer need the resource because these resources are rather expensive and they aren&#x2019;t easily closed by themselves (the Garbage Collector will eventually handle it if we do not keep any reference to this resource, but it will take some time). Therefore, to be sure that we will not miss closing them, we traditionally wrapped such resources in a <code>try-finally</code> block and called <code>close</code> there:
&#x95EE;&#x9898;&#x662F;,&#x5728;&#x6240;&#x6709;&#x8FD9;&#x4E9B;&#x60C5;&#x51B5;&#x4E0B;,&#x6211;&#x4EEC;&#x9700;&#x8981;&#x786E;&#x4FDD;&#x6211;&#x4EEC;&#x8C03;&#x7528;&#x201C;&#x5173;&#x95ED;&#x201D;&#x65B9;&#x6CD5;&#x5F53;&#x6211;&#x4EEC;&#x4E0D;&#x518D;&#x9700;&#x8981;&#x7684;&#x8D44;&#x6E90;,&#x56E0;&#x4E3A;&#x8FD9;&#x4E9B;&#x8D44;&#x6E90;&#x662F;&#x76F8;&#x5F53;&#x6602;&#x8D35;&#x7684;,&#x4ED6;&#x4EEC;&#x4E0D;&#x5BB9;&#x6613;&#x5C01;&#x95ED;&#x81EA;&#x5DF1;(&#x5783;&#x573E;&#x6536;&#x96C6;&#x5668;&#x5C06;&#x6700;&#x7EC8;&#x5904;&#x7406;&#x5B83;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x4E0D;&#x4FDD;&#x6301;&#x4EFB;&#x4F55;&#x5F15;&#x7528;&#x8FD9;&#x4E2A;&#x8D44;&#x6E90;,&#x4F46;&#x8FD9;&#x9700;&#x8981;&#x4E00;&#x4E9B;&#x65F6;&#x95F4;)&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x4E3A;&#x4E86;&#x786E;&#x4FDD;&#x6211;&#x4EEC;&#x4E0D;&#x4F1A;&#x9519;&#x8FC7;&#x5173;&#x95ED;&#x5B83;&#x4EEC;&#xFF0C;&#x6211;&#x4EEC;&#x901A;&#x5E38;&#x4F1A;&#x5C06;&#x8FD9;&#x4E9B;&#x8D44;&#x6E90;&#x5305;&#x88C5;&#x5728;&#x4E00;&#x4E2A;&#x201C;try-finally&#x201D;&#x5757;&#x4E2D;&#xFF0C;&#x5E76;&#x5728;&#x90A3;&#x91CC;&#x8C03;&#x7528;&#x201C;close&#x201D;:</p>
<pre><code class="lang-kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">countCharactersInFile</span><span class="hljs-params">(path: <span class="hljs-type">String</span>)</span>: <span class="hljs-keyword">Int</span> {</span>
   <span class="hljs-variable"><span class="hljs-keyword">val</span> reader</span> = BufferedReader(FileReader(path))
   <span class="hljs-keyword">try</span> {
       <span class="hljs-keyword">return</span> reader.lineSequence().sumBy { it.length }
   } <span class="hljs-keyword">finally</span> {
       reader.close()
   }
}
</code></pre>
<p>Such a structure is complicated and incorrect. It is incorrect because close can throw an error, and such an error will not be caught. Also, if we had errors from both the body of the <code>try</code> and from <code>finally</code> blocks, only one would be properly propagated. The behavior we should expect is for the information about the new error to be added to the previous one. The proper implementation of this is long and complicated, but it is also common and so it has been extracted into the <code>use</code>function from the standard library. It should be used to properly close resources and handle exceptions. This function can be used on any <code>Closeable</code> object:</p>
<p>&#x8FD9;&#x6837;&#x7684;&#x7ED3;&#x6784;&#x662F;&#x590D;&#x6742;&#x548C;&#x4E0D;&#x6B63;&#x786E;&#x7684;&#x3002;&#x5B83;&#x662F;&#x4E0D;&#x6B63;&#x786E;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;close&#x53EF;&#x4EE5;&#x629B;&#x51FA;&#x9519;&#x8BEF;&#xFF0C;&#x800C;&#x8FD9;&#x6837;&#x7684;&#x9519;&#x8BEF;&#x5C06;&#x4E0D;&#x4F1A;&#x88AB;&#x6355;&#x83B7;&#x3002;&#x6B64;&#x5916;&#xFF0C;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x540C;&#x65F6;&#x4ECE;&#x201C;try&#x201D;&#x548C;&#x201C;finally&#x201D;&#x5757;&#x7684;&#x4F53;&#x4E2D;&#x51FA;&#x73B0;&#x9519;&#x8BEF;&#xFF0C;&#x90A3;&#x4E48;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x9519;&#x8BEF;&#x4F1A;&#x88AB;&#x6B63;&#x786E;&#x4F20;&#x64AD;&#x3002;&#x6211;&#x4EEC;&#x5E94;&#x8BE5;&#x671F;&#x671B;&#x7684;&#x884C;&#x4E3A;&#x662F;&#x5C06;&#x5173;&#x4E8E;&#x65B0;&#x9519;&#x8BEF;&#x7684;&#x4FE1;&#x606F;&#x6DFB;&#x52A0;&#x5230;&#x524D;&#x4E00;&#x4E2A;&#x9519;&#x8BEF;&#x4E2D;&#x3002;&#x6B63;&#x786E;&#x7684;&#x5B9E;&#x73B0;&#x662F;&#x6F2B;&#x957F;&#x800C;&#x590D;&#x6742;&#x7684;&#xFF0C;&#x4F46;&#x5B83;&#x4E5F;&#x662F;&#x5E38;&#x89C1;&#x7684;&#xFF0C;&#x56E0;&#x6B64;&#x5B83;&#x88AB;&#x4ECE;&#x6807;&#x51C6;&#x5E93;&#x4E2D;&#x63D0;&#x53D6;&#x5230;&apos; use &apos;&#x51FD;&#x6570;&#x4E2D;&#x3002;&#x5E94;&#x8BE5;&#x4F7F;&#x7528;&#x5B83;&#x6765;&#x6B63;&#x786E;&#x5173;&#x95ED;&#x8D44;&#x6E90;&#x548C;&#x5904;&#x7406;&#x5F02;&#x5E38;&#x3002;&#x6B64;&#x51FD;&#x6570;&#x53EF;&#x7528;&#x4E8E;&#x4EFB;&#x4F55;&apos; Closeable &apos;&#x5BF9;&#x8C61;:</p>
<pre><code class="lang-kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">countCharactersInFile</span><span class="hljs-params">(path: <span class="hljs-type">String</span>)</span>: <span class="hljs-keyword">Int</span> {</span>
   <span class="hljs-variable"><span class="hljs-keyword">val</span> reader</span> = BufferedReader(FileReader(path))
   reader.use {
       <span class="hljs-keyword">return</span> reader.lineSequence().sumBy { it.length }
   }
}
</code></pre>
<p>Receiver (<code>reader</code> in this case) is also passed as an argument to the lambda, so the syntax can be shortened:
Receiver(&#x672C;&#x4F8B;&#x4E2D;&#x4E3A;&apos; reader &apos;)&#x4E5F;&#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#x4F20;&#x9012;&#x7ED9;lambda&#xFF0C;&#x56E0;&#x6B64;&#x8BED;&#x6CD5;&#x53EF;&#x4EE5;&#x7F29;&#x77ED;:</p>
<pre><code class="lang-kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">countCharactersInFile</span><span class="hljs-params">(path: <span class="hljs-type">String</span>)</span>: <span class="hljs-keyword">Int</span> {</span>
   BufferedReader(FileReader(path)).use { reader -&gt;
       <span class="hljs-keyword">return</span> reader.lineSequence().sumBy { it.length }
   }
}
</code></pre>
<p>As this support is often needed for files, and as it is common to read files line-by-line, there is also a <code>useLines</code> function in the Kotlin Standard Library that gives us a sequence of lines (<code>String</code>) and closes the underlying reader once the processing is complete:
&#x7531;&#x4E8E;&#x6587;&#x4EF6;&#x901A;&#x5E38;&#x9700;&#x8981;&#x8FD9;&#x79CD;&#x652F;&#x6301;&#xFF0C;&#x5E76;&#x4E14;&#x9010;&#x884C;&#x8BFB;&#x53D6;&#x6587;&#x4EF6;&#x662F;&#x5E38;&#x89C1;&#x7684;&#xFF0C;Kotlin&#x6807;&#x51C6;&#x5E93;&#x4E2D;&#x4E5F;&#x6709;&#x4E00;&#x4E2A;&apos; useLines &apos;&#x51FD;&#x6570;&#xFF0C;&#x5B83;&#x7ED9;&#x6211;&#x4EEC;&#x4E00;&#x4E2A;&#x884C;&#x5E8F;&#x5217;(&apos; String &apos;)&#xFF0C;&#x5E76;&#x5728;&#x5904;&#x7406;&#x5B8C;&#x6210;&#x540E;&#x5173;&#x95ED;&#x5E95;&#x5C42;&#x8BFB;&#x53D6;&#x5668;:</p>
<pre><code class="lang-kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">countCharactersInFile</span><span class="hljs-params">(path: <span class="hljs-type">String</span>)</span>: <span class="hljs-keyword">Int</span> {</span>
   File(path).useLines { lines -&gt;
       <span class="hljs-keyword">return</span> lines.sumBy { it.length }
   }
}
</code></pre>
<p>This is a proper way to process even large files as this sequence will read lines on-demand and does not hold more than one line at a time in memory. The cost is that this sequence can be used only once. If you need to iterate over the lines of the file more than once, you need to open it more than once. The <code>useLines</code> function can be also used as an expression:
&#x8FD9;&#x662F;&#x4E00;&#x79CD;&#x5904;&#x7406;&#x5927;&#x578B;&#x6587;&#x4EF6;&#x7684;&#x9002;&#x5F53;&#x65B9;&#x6CD5;&#xFF0C;&#x56E0;&#x4E3A;&#x8BE5;&#x5E8F;&#x5217;&#x5C06;&#x6309;&#x9700;&#x8BFB;&#x53D6;&#x884C;&#xFF0C;&#x5E76;&#x4E14;&#x5728;&#x5185;&#x5B58;&#x4E2D;&#x6BCF;&#x6B21;&#x4FDD;&#x5B58;&#x7684;&#x884C;&#x6570;&#x4E0D;&#x8D85;&#x8FC7;&#x4E00;&#x884C;&#x3002;&#x4EE3;&#x4EF7;&#x662F;&#x8FD9;&#x4E2A;&#x5E8F;&#x5217;&#x53EA;&#x80FD;&#x4F7F;&#x7528;&#x4E00;&#x6B21;&#x3002;&#x5982;&#x679C;&#x9700;&#x8981;&#x591A;&#x6B21;&#x904D;&#x5386;&#x6587;&#x4EF6;&#x7684;&#x884C;&#xFF0C;&#x5219;&#x9700;&#x8981;&#x591A;&#x6B21;&#x6253;&#x5F00;&#x5B83;&#x3002;&apos; useLines &apos;&#x51FD;&#x6570;&#x4E5F;&#x53EF;&#x4EE5;&#x7528;&#x4F5C;&#x8868;&#x8FBE;&#x5F0F;:</p>
<pre><code class="lang-kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">countCharactersInFile</span><span class="hljs-params">(path: <span class="hljs-type">String</span>)</span>: <span class="hljs-keyword">Int</span> =</span>
   File(path).useLines { lines -&gt; 
       lines.sumBy { it.length } 
   }
</code></pre>
<p>All the above implementations use sequences to operate on the file and it is the correct way to do it. Thanks to that we can always read only one line instead of loading the content of the whole file. More about it in the item <em>Item 49: Prefer Sequence for big collections with more than one processing step</em>.
&#x4EE5;&#x4E0A;&#x6240;&#x6709;&#x5B9E;&#x73B0;&#x90FD;&#x4F7F;&#x7528;&#x5E8F;&#x5217;&#x5BF9;&#x6587;&#x4EF6;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;&#xFF0C;&#x8FD9;&#x662F;&#x6B63;&#x786E;&#x7684;&#x65B9;&#x6CD5;&#x3002;&#x7531;&#x4E8E;&#x8FD9;&#x6837;&#xFF0C;&#x6211;&#x4EEC;&#x603B;&#x662F;&#x53EF;&#x4EE5;&#x53EA;&#x8BFB;&#x53D6;&#x4E00;&#x884C;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x52A0;&#x8F7D;&#x6574;&#x4E2A;&#x6587;&#x4EF6;&#x7684;&#x5185;&#x5BB9;&#x3002;item 49:&#x5BF9;&#x4E8E;&#x5177;&#x6709;&#x591A;&#x4E2A;&#x5904;&#x7406;&#x6B65;&#x9AA4;&#x7684;&#x5927;&#x96C6;&#x5408;&#xFF0C;&#x66F4;&#x559C;&#x6B22;&#x4F7F;&#x7528;Prefer Sequence&#x3002;</p>
<h3 id="summary">Summary</h3>
<p>Operate on objects implementing <code>Closeable</code> or <code>AutoCloseable</code> using <code>use</code>. It is a safe and easy option. When you need to operate on a file, consider <code>useLines</code> that produces a sequence to iterate over the next lines.
&#x4F7F;&#x7528;&#x201C;use&#x201D;&#x5BF9;&#x5B9E;&#x73B0;&#x201C;Closeable&#x201D;&#x6216;&#x201C;AutoCloseable&#x201D;&#x7684;&#x5BF9;&#x8C61;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;&#x3002;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x5B89;&#x5168;&#x4E14;&#x7B80;&#x5355;&#x7684;&#x9009;&#x62E9;&#x3002;&#x5F53;&#x4F60;&#x9700;&#x8981;&#x64CD;&#x4F5C;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x65F6;&#xFF0C;&#x8003;&#x8651;&apos; useLines &apos;&#xFF0C;&#x5B83;&#x4F1A;&#x751F;&#x6210;&#x4E00;&#x4E2A;&#x5E8F;&#x5217;&#x6765;&#x904D;&#x5386;&#x4E0B;&#x4E00;&#x884C;&#x3002;</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="Item 8 Handle nulls properly.html" class="navigation navigation-prev " aria-label="Previous page: Item 8 Handle Nulls Properly">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="Item 10 Write unit tests.html" class="navigation navigation-next " aria-label="Next page: Item 10 Write Unit Tests">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Item 9 Close Resources With Use","level":"1.2.1.10","depth":3,"next":{"title":"Item 10 Write Unit Tests","level":"1.2.1.11","depth":3,"path":"Part 1 Good code/Chapter 1 Safety/Item 10 Write unit tests.md","ref":"Part 1 Good code/Chapter 1 Safety/Item 10 Write unit tests.md","articles":[]},"previous":{"title":"Item 8 Handle Nulls Properly","level":"1.2.1.9","depth":3,"path":"Part 1 Good code/Chapter 1 Safety/Item 8 Handle nulls properly.md","ref":"Part 1 Good code/Chapter 1 Safety/Item 8 Handle nulls properly.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":[],"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"Part 1 Good code/Chapter 1 Safety/Item 9 Close resources with use.md","mtime":"2022-07-31T13:38:59.636Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2022-07-31T13:39:42.832Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

